<style>body {margin: 0;} canvas {display: block;}</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/3.0.11/pixi.min.js"></script>

<script>
  const TILE_SIZE = new PIXI.Rectangle(0, 0, 32, 20);
  const SCALE_MODE = PIXI.SCALE_MODES.NEAREST;

  function loadTerrainTexture(url, size=new PIXI.Point(32, 20)) {
    const texture = PIXI.BaseTexture.fromImage('tiles/ground.png', false, SCALE_MODE);

    return {
      t: new PIXI.Texture(texture, new PIXI.Rectangle(size.x, size.y, size.x, size.y)),
      n: new PIXI.Texture(texture, new PIXI.Rectangle(size.x, 0, size.x, size.y)),
      s: new PIXI.Texture(texture, new PIXI.Rectangle(size.x, size.y * 2, size.x, size.y)),
      w: new PIXI.Texture(texture, new PIXI.Rectangle(0, size.y, size.x, size.y)),
      e: new PIXI.Texture(texture, new PIXI.Rectangle(size.x * 2, size.y, size.x, size.y)),
      nw: new PIXI.Texture(texture, new PIXI.Rectangle(0, 0, size.x, size.y)),
      ne: new PIXI.Texture(texture, new PIXI.Rectangle(size.x * 2, 0, size.x, size.y)),
      sw: new PIXI.Texture(texture, new PIXI.Rectangle(0, size.y * 2, size.x, size.y)),
      se: new PIXI.Texture(texture, new PIXI.Rectangle(size.x * 2, size.y * 2, size.x, size.y)),
    }
  }

  function createGround(texture, rect) {
    const ground = new PIXI.Container();
    const debug = new PIXI.Graphics();

    ground.rect = rect;
    ground.x = rect.x * TILE_SIZE.width;
    ground.y = rect.y * TILE_SIZE.height;

    console.log(rect.width * TILE_SIZE.width);

    debug.lineStyle(0.5, 0xFF0000);
    debug.drawRect(0, 0, rect.width * TILE_SIZE.width, rect.height * TILE_SIZE.height);

    const sprites = {
      t: new PIXI.extras.TilingSprite(texture.t, rect.width * TILE_SIZE.width, rect.height * TILE_SIZE.height),
      n: new PIXI.extras.TilingSprite(texture.n, rect.width * TILE_SIZE.width, TILE_SIZE.height),
      s: new PIXI.extras.TilingSprite(texture.s, rect.width * TILE_SIZE.width, TILE_SIZE.height),
      e: new PIXI.extras.TilingSprite(texture.e, TILE_SIZE.width, rect.height * TILE_SIZE.height),
      w: new PIXI.extras.TilingSprite(texture.w, TILE_SIZE.width, rect.height * TILE_SIZE.height),
      nw: new PIXI.Sprite(texture.nw, TILE_SIZE.width, TILE_SIZE.height),
      ne: new PIXI.Sprite(texture.ne, TILE_SIZE.width, TILE_SIZE.height),
      sw: new PIXI.Sprite(texture.sw, TILE_SIZE.width, TILE_SIZE.height),
      se: new PIXI.Sprite(texture.se, TILE_SIZE.width, TILE_SIZE.height),
    }

    sprites.n.y = -TILE_SIZE.height;
    sprites.s.y = rect.height * TILE_SIZE.height;
    sprites.w.x = -TILE_SIZE.width;
    sprites.e.x = rect.width * TILE_SIZE.width;
    sprites.nw.x = -TILE_SIZE.width;
    sprites.nw.y = -TILE_SIZE.height;
    sprites.ne.x = rect.width * TILE_SIZE.width;
    sprites.ne.y = -TILE_SIZE.height;
    sprites.sw.x = -TILE_SIZE.width;
    sprites.sw.y = rect.height * TILE_SIZE.height;
    sprites.se.x = rect.width * TILE_SIZE.width;
    sprites.se.y = rect.height * TILE_SIZE.height;

    Object.keys(sprites).forEach(key => ground.addChild(sprites[key]));

    // ground.addChild(debug);

    return ground;
  }

  const stage = new PIXI.Container();

  stage.scale = new PIXI.Point(4, 4);

  const renderer = PIXI.autoDetectRenderer(window.innerWidth, window.innerHeight);

  const grassHillTexture = loadTerrainTexture('tiles/ground.png');

  const hills = [
    createGround(grassHillTexture, new PIXI.Rectangle(2, 2, 3, 3)),
    createGround(grassHillTexture, new PIXI.Rectangle(2, 3, 2, 1)),
    createGround(grassHillTexture, new PIXI.Rectangle(0, 0, 1, 3))
  ];

  const ground = new PIXI.extras.TilingSprite(grassHillTexture.t, 10 * TILE_SIZE.width, 10 * TILE_SIZE.height);

  stage.addChild(ground);

  hills.forEach(hill => stage.addChild(hill));

  function render() {
    requestAnimationFrame(render);
    renderer.render(stage);
  }

  window.addEventListener('load', () => {
    document.body.appendChild(renderer.view);
    requestAnimationFrame(render);
  })
</script>
